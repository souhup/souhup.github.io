---
title: 搭建代理
categories:
  - tutorial
tags:
  - v2ray
  - 代理
---


为了加快访问外网的速度, 在搭建服务器后, 我们可以通过如下的方式安装代理软件, 代理软件我们选择v2ray. 

### 安装v2ray

```bash
curl https://raw.githubusercontent.com/v2fly/v2ray-core/master/release/install-release.sh
bash ./install-release.sh
```

### 配置NGINX

安装v2ray后,配置https的伪装类型

```nginx

# Settings for a TLS enabled server.
#
    server {
        listen       443 ssl http2 default_server;
        listen       [::]:443 ssl http2 default_server;
        server_name  _;
        root         /usr/share/nginx/html;

        ssl_certificate "/opt/tls/domain.pem";
        ssl_certificate_key "/opt/tls/domain.key";
        ssl_session_cache shared:SSL:1m;
        ssl_session_timeout  10m;
        ssl_ciphers HIGH:!aNULL:!MD5;
        ssl_prefer_server_ciphers on;

        # Load configuration files for the default server block.
        include /etc/nginx/default.d/*.conf;

        location / {
        }

        location /link { 
              proxy_redirect off;
              proxy_pass http://127.0.0.1:9000; 
              proxy_http_version 1.1;
              proxy_set_header Upgrade $http_upgrade;
              proxy_set_header Connection "upgrade";
              proxy_set_header Host $host;
              # Show real IP in v2ray access.log
              proxy_set_header X-Real-IP $remote_addr;
              proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        error_page 404 /404.html;
            location = /40x.html {
        }

        error_page 500 502 503 504 /50x.html;
            location = /50x.html {
        }
    }
```

### 配置v2ray

```json
{
  "log" : {
    "access": "/var/log/v2ray/access.log",
    "error": "/var/log/v2ray/error.log",
    "loglevel": "warning"
  },
  "inbounds": [{
    "port": 9000,
    "protocol": "vmess",
    "settings": {
      "clients": [
        {
          "id": "???????",
          "level": 1,
          "alterId": 64
        }
      ]
    },
   "streamSettings": {
        "network": "ws",
        "wsSettings": {
          "path": "/????"
        }
    },
    "listen": "127.0.0.1"

  }],
  "outbounds": [{
    "protocol": "freedom",
    "settings": {}
  },{
    "protocol": "blackhole",
    "settings": {},
    "tag": "blocked"
  }],
  "routing": {
    "rules": [
      {
        "type": "field",
        "ip": ["geoip:private"],
        "outboundTag": "blocked"
      }
    ]
  }
}
```
